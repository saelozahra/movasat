{% extends "base.html" %}
{% block content %}

    {% include "course.html" %}
    
    <section id="ghasem_vid" class="row">
        <video class="simple" onplay="this.volume = 0.05;" autoplay loop src="/static/assets/emad.mp4"></video>

        <div class="pngwing tr">
            <br>
            <a class="btn fr effect-shine" href="{% url "UserCreate" %}">
                <i class="mdi mdi-face-outline fr"></i>
                من دنبال کار هستم
            </a>
            <a class="btn fr effect-shine" href="{% url "JobCreate" %}">
                <i class="mdi mdi-apple-finder fr"></i>
                من دنبال کارمند میگردم
            </a>
        </div>
    </section>

    {% include "harkat.html" %}


    {% include "challenge.html" %}




    <div class="row" style="padding: 2rem 0; margin: 2rem auto">
        <div class="container">
            <h2 class="title_line"><span class="tc">
                نقشه پراکندگی
                <i class="mdi mdi-moon-first-quarter"></i>
                پروژه‌های جهادی
                <i class="mdi mdi-moon-last-quarter"></i>
            </span></h2>
            <div class="row br" style="box-shadow: -5px 5px 13px darkgray;overflow: hidden;" >
                <div id="map" class="map"></div>
            </div>
        </div>
    </div>

{% endblock content %}



{% block scripts %}
<script>

    var center = ol.proj.transform([52.5640869140625, 29.591371238663804], 'EPSG:4326', 'EPSG:3857'); //initial position of map
    var view = new ol.View({
        center: center,
        zoom: 8
    });

//raster layer on map
   var OSMBaseLayer = new ol.layer.Tile({
        source: new ol.source.OSM()
    });

 straitSource = new ol.source.Vector({ wrapX: true });
    var straitsLayer = new ol.layer.Vector({
        source: straitSource
    });

 map = new ol.Map({
        layers: [OSMBaseLayer, straitsLayer],
        target: 'map',
        view: view,
        controls: [new ol.control.FullScreen(), new ol.control.Zoom()]
    });

   // Popup showing the position the user clicked
    var container = document.getElementById('popup');
    var popup = new ol.Overlay({
        element: container,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    });
    map.addOverlay(popup);


var data=[
    {% for mi in map %}
        {
            "title":"{{ mi.title }}",
            "photo":"{{ mi.photo }}",
            "icon":"{{ mi.icon }}",
            "lng":{{ mi.lng }},
            "lat":{{ mi.lat }},
            "url":"{{ mi.get_absolute_url }}"
        },
    {% endfor %}
];

function addPointGeom(data) {
    data.forEach(function(item) {
        var title = item.title,
        iconFeature = new ol.Feature({
            geometry: new ol.geom.Point(ol.proj.transform([item.lng, item.lat], 'EPSG:4326',
                'EPSG:3857')),
            type: 'Point',
            url: item.url,
            desc: '<div style="font-family: var(--font);direction: rtl;"> <p style="float: right;"><b>' + title + ' </b> ' + '</p>  <img style="max-width: 162px;display: inline-block;border-radius: 5px;margin-bottom: -5px" src="'+item.photo+'" > </div>'}),
        iconStyle = new ol.style.Style({
            image: new ol.style.Icon({
                scale: 0.4,
                anchor: [0.5, 1],
{#                  src: '/static/img/social_media_network_online_maps-64.webp'#}
                src: item.icon,
            })
        });
        iconFeature.setStyle(iconStyle);
        straitSource.addFeature(iconFeature);

    });
}// End of function showStraits()

addPointGeom(data);


</script>
{% endblock scripts %}
